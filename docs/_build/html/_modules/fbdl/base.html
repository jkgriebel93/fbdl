<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fbdl.base &#8212; fbdl 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for fbdl.base</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ffmpeg</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">mutagen.mp4</span><span class="w"> </span><span class="kn">import</span> <span class="n">MP4</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">yt_dlp</span><span class="w"> </span><span class="kn">import</span> <span class="n">YoutubeDL</span>

<span class="n">abbreviation_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;PIT&quot;</span><span class="p">:</span> <span class="s2">&quot;Pittsburgh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CLE&quot;</span><span class="p">:</span> <span class="s2">&quot;Cleveland&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CIN&quot;</span><span class="p">:</span> <span class="s2">&quot;Cincinnati&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BAL&quot;</span><span class="p">:</span> <span class="s2">&quot;Baltimore&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IND&quot;</span><span class="p">:</span> <span class="s2">&quot;Indianapolis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HOU&quot;</span><span class="p">:</span> <span class="s2">&quot;Houston&quot;</span><span class="p">,</span>
    <span class="s2">&quot;JAX&quot;</span><span class="p">:</span> <span class="s2">&quot;Jacksonville&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TEN&quot;</span><span class="p">:</span> <span class="s2">&quot;Tennessee&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NWE&quot;</span><span class="p">:</span> <span class="s2">&quot;New England&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NYJ&quot;</span><span class="p">:</span> <span class="s2">&quot;New York (A)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MIA&quot;</span><span class="p">:</span> <span class="s2">&quot;Miami&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BUF&quot;</span><span class="p">:</span> <span class="s2">&quot;Buffalo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KAN&quot;</span><span class="p">:</span> <span class="s2">&quot;Kansas City&quot;</span><span class="p">,</span>
    <span class="s2">&quot;KC&quot;</span><span class="p">:</span> <span class="s2">&quot;Kansas City&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OAK&quot;</span><span class="p">:</span> <span class="s2">&quot;Oakland&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LV&quot;</span><span class="p">:</span> <span class="s2">&quot;Las Vegas&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LVR&quot;</span><span class="p">:</span> <span class="s2">&quot;Las Vegas&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DEN&quot;</span><span class="p">:</span> <span class="s2">&quot;Denver&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SD&quot;</span><span class="p">:</span> <span class="s2">&quot;San Diego&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SDG&quot;</span><span class="p">:</span> <span class="s2">&quot;San Diego&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LAC&quot;</span><span class="p">:</span> <span class="s2">&quot;Los Angeles (A)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GNB&quot;</span><span class="p">:</span> <span class="s2">&quot;Green Bay&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GB&quot;</span><span class="p">:</span> <span class="s2">&quot;Green Bay&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MIN&quot;</span><span class="p">:</span> <span class="s2">&quot;Minnesota&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DET&quot;</span><span class="p">:</span> <span class="s2">&quot;Detroit&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CHI&quot;</span><span class="p">:</span> <span class="s2">&quot;Chicago&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TAM&quot;</span><span class="p">:</span> <span class="s2">&quot;Tampa Bay&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TB&quot;</span><span class="p">:</span> <span class="s2">&quot;Tampa Bay&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CAR&quot;</span><span class="p">:</span> <span class="s2">&quot;Carolina&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ATL&quot;</span><span class="p">:</span> <span class="s2">&quot;Atlanta&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NO&quot;</span><span class="p">:</span> <span class="s2">&quot;New Orleans&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NOR&quot;</span><span class="p">:</span> <span class="s2">&quot;New Orleans&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NYG&quot;</span><span class="p">:</span> <span class="s2">&quot;New York (N)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WAS&quot;</span><span class="p">:</span> <span class="s2">&quot;Washington&quot;</span><span class="p">,</span>
    <span class="s2">&quot;DAL&quot;</span><span class="p">:</span> <span class="s2">&quot;Dallas&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PHI&quot;</span><span class="p">:</span> <span class="s2">&quot;Philadelphia&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARI&quot;</span><span class="p">:</span> <span class="s2">&quot;Arizona&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARZ&quot;</span><span class="p">:</span> <span class="s2">&quot;Arizona&quot;</span><span class="p">,</span>
    <span class="s2">&quot;LAR&quot;</span><span class="p">:</span> <span class="s2">&quot;Los Angeles (N)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;STL&quot;</span><span class="p">:</span> <span class="s2">&quot;St. Louis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SEA&quot;</span><span class="p">:</span> <span class="s2">&quot;Seattle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SF&quot;</span><span class="p">:</span> <span class="s2">&quot;San Francisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SFO&quot;</span><span class="p">:</span> <span class="s2">&quot;San Francisco&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RAM&quot;</span><span class="p">:</span> <span class="s2">&quot;Los Angeles (N)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RAI&quot;</span><span class="p">:</span> <span class="s2">&quot;Los Angeles Raiders&quot;</span><span class="p">,</span>
    <span class="s2">&quot;PHO&quot;</span><span class="p">:</span> <span class="s2">&quot;Phoenix&quot;</span><span class="p">,</span>
    <span class="c1"># CFL</span>
    <span class="s2">&quot;MON&quot;</span><span class="p">:</span> <span class="s2">&quot;Montreal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MTL&quot;</span><span class="p">:</span> <span class="s2">&quot;Montreal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HAM&quot;</span><span class="p">:</span> <span class="s2">&quot;Hamilton&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CGY&quot;</span><span class="p">:</span> <span class="s2">&quot;Calgary&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TOR&quot;</span><span class="p">:</span> <span class="s2">&quot;Toronto&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SSK&quot;</span><span class="p">:</span> <span class="s2">&quot;Saskatchewan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BC&quot;</span><span class="p">:</span> <span class="s2">&quot;British Columbia&quot;</span><span class="p">,</span>
    <span class="s2">&quot;OTT&quot;</span><span class="p">:</span> <span class="s2">&quot;Ottawa&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WPG&quot;</span><span class="p">:</span> <span class="s2">&quot;Winnipeg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;EDM&quot;</span><span class="p">:</span> <span class="s2">&quot;Edmonton&quot;</span><span class="p">,</span>
    <span class="c1"># UFL</span>
    <span class="s2">&quot;DC&quot;</span><span class="p">:</span> <span class="s2">&quot;Washington DC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ARL&quot;</span><span class="p">:</span> <span class="s2">&quot;Arlington&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SA&quot;</span><span class="p">:</span> <span class="s2">&quot;San Antonio&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BHM&quot;</span><span class="p">:</span> <span class="s2">&quot;Birmingham&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BHAM&quot;</span><span class="p">:</span> <span class="s2">&quot;Birminghame&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MICH&quot;</span><span class="p">:</span> <span class="s2">&quot;Michigan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MEM&quot;</span><span class="p">:</span> <span class="s2">&quot;Memphis&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">CITY_TO_ABBR</span> <span class="o">=</span> <span class="p">{</span><span class="n">city</span><span class="p">:</span> <span class="n">abbr</span> <span class="k">for</span> <span class="n">abbr</span><span class="p">,</span> <span class="n">city</span> <span class="ow">in</span> <span class="n">abbreviation_map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">CONCURRENT_FRAGMENTS</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;CONCURRENT_FRAGMENTS&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">DEFAULT_REPLAY_TYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;full_game&quot;</span><span class="p">:</span> <span class="s2">&quot;Full Game&quot;</span><span class="p">,</span>
    <span class="s2">&quot;all_22&quot;</span><span class="p">:</span> <span class="s2">&quot;All-22&quot;</span><span class="p">,</span>
    <span class="s2">&quot;condensed_game&quot;</span><span class="p">:</span> <span class="s2">&quot;Condensed Game&quot;</span><span class="p">,</span>
    <span class="s2">&quot;full_game_alternative&quot;</span><span class="p">:</span> <span class="s2">&quot;Full Game - Alternative Broadcasts&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">MEDIA_BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MEDIA_BASE_DIR&quot;</span><span class="p">)</span>
<span class="n">THROTTLED_RATE_LIMIT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;THROTTLED_RATE_LIMIT&quot;</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>


<div class="viewcode-block" id="convert_nfl_playoff_name_to_int">
<a class="viewcode-back" href="../../api.html#fbdl.base.convert_nfl_playoff_name_to_int">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_nfl_playoff_name_to_int</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">week_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a season and week name, determine the week number of the game.</span>

<span class="sd">    :param year: The year during which the regular season associated with the postseason game was played.</span>
<span class="sd">    :type year: int</span>
<span class="sd">    :param week_name: The game&#39;s name. One of &#39;Wild Card&#39;, &#39;Divisional&#39;, &#39;Conference Championship&#39;, or &#39;Super Bowl&#39;</span>
<span class="sd">    :type week_name: str</span>
<span class="sd">    :return: The week number that the named game was played during the provided season.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1978</span><span class="p">:</span>
        <span class="c1"># Through 1997: 14 week schedule, no bye week, no wildcard</span>
        <span class="k">if</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Divisional&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="k">elif</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Conference Championship&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="k">elif</span> <span class="s2">&quot;Super Bowl&quot;</span> <span class="ow">in</span> <span class="n">week_name</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">17</span>
    <span class="k">elif</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1990</span><span class="p">:</span>
        <span class="c1"># 1978 - 1989: 16 week schedule, no bye week, wildcard round</span>
        <span class="k">if</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Wild Card&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="k">elif</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Divisional&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">18</span>
        <span class="k">elif</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Conference Championship&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">19</span>
        <span class="k">elif</span> <span class="s2">&quot;Super Bowl&quot;</span> <span class="ow">in</span> <span class="n">week_name</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="k">elif</span> <span class="n">year</span> <span class="o">==</span> <span class="mi">1993</span> <span class="ow">or</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2020</span><span class="p">:</span>
        <span class="c1"># 1993: 18 week schedule, two bye weeks (16 games), wildcard round</span>
        <span class="c1"># 2021 - Current: 18 week schedule (17 games), wildcard round, results in</span>
        <span class="c1"># Same numbering as 1993</span>
        <span class="k">if</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Wild Card&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">19</span>
        <span class="k">elif</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Divisional&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">elif</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Conference Championship&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">21</span>
        <span class="k">elif</span> <span class="s2">&quot;Super Bowl&quot;</span> <span class="ow">in</span> <span class="n">week_name</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">22</span>
    <span class="k">elif</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2021</span><span class="p">:</span>
        <span class="c1"># 1990 - 2020 (except 1993): 17 week schedule, one bye week, wildcard round</span>
        <span class="k">if</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Wild Card&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">18</span>
        <span class="k">elif</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Divisional&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">19</span>
        <span class="k">elif</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Conference Championship&quot;</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">elif</span> <span class="s2">&quot;Super Bowl&quot;</span> <span class="ow">in</span> <span class="n">week_name</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">21</span>

    <span class="k">return</span> <span class="n">num</span></div>



<div class="viewcode-block" id="convert_ufl_playoff_name_to_int">
<a class="viewcode-back" href="../../api.html#fbdl.base.convert_ufl_playoff_name_to_int">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">convert_ufl_playoff_name_to_int</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">week_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a UFL season and a week name, determine the week number of the game.</span>

<span class="sd">    :param year: The year the game was played. Included for potential future schedule changes.</span>
<span class="sd">    :param week_name: The game&#39;s name. One of &#39;Conference Championship&#39; or &#39;UFL Championship&#39;</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;Conference Championship&quot;</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="k">elif</span> <span class="n">week_name</span> <span class="o">==</span> <span class="s2">&quot;UFL Championship&quot;</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="k">return</span> <span class="n">num</span></div>



<div class="viewcode-block" id="get_week_int_as_string">
<a class="viewcode-back" href="../../api.html#fbdl.base.get_week_int_as_string">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_week_int_as_string</span><span class="p">(</span>
    <span class="n">week</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">is_ufl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a week&#39;s name and a season, determine the week number of the game.</span>

<span class="sd">    :param week: The week name (e.g. &#39;Wild Card&#39;, &#39;Divisional&#39;, etc.)</span>
<span class="sd">    :type week: int</span>
<span class="sd">    :param year: The season that the game was played.</span>
<span class="sd">    :type year: int</span>
<span class="sd">    :param is_ufl: A flag used to specify which conversion function is uses.</span>
<span class="sd">    :type is_ufl: bool</span>
<span class="sd">    :return: A string, left padded to a length of 2, representing the week number of the game.</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">:=</span> <span class="n">is_playoff_week</span><span class="p">(</span><span class="n">week</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_ufl</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">convert_ufl_playoff_name_to_int</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">week_name</span><span class="o">=</span><span class="n">num</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">convert_nfl_playoff_name_to_int</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">week_name</span><span class="o">=</span><span class="n">num</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">week</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;wk&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="k">break</span>
        <span class="n">num</span> <span class="o">+=</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>



<div class="viewcode-block" id="is_bowl_game">
<a class="viewcode-back" href="../../api.html#fbdl.base.is_bowl_game">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_bowl_game</span><span class="p">(</span><span class="n">orig_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a (properly named) Path object, determine if it</span>
<span class="sd">    represents an NCAA bowl/playoff game and return the game&#39;s name.</span>

<span class="sd">    :param orig_file: The Path object for the video file we&#39;re inspecting.</span>
<span class="sd">    :type orig_file: Path</span>
<span class="sd">    :return: Either the empty string or the name of the bowl game.</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bowl_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">named_game</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;SEC Championship &quot;</span><span class="p">,</span>
        <span class="s2">&quot;Orange Bowl &quot;</span><span class="p">,</span>
        <span class="s2">&quot;CFP Final &quot;</span><span class="p">,</span>
        <span class="s2">&quot;Peach Bowl CFP Semi-Final&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">if</span> <span class="n">named_game</span> <span class="ow">in</span> <span class="n">orig_file</span><span class="o">.</span><span class="n">stem</span><span class="p">:</span>
            <span class="n">bowl_str</span> <span class="o">=</span> <span class="n">named_game</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">bowl_str</span></div>



<div class="viewcode-block" id="is_playoff_week">
<a class="viewcode-back" href="../../api.html#fbdl.base.is_playoff_week">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_playoff_week</span><span class="p">(</span><span class="n">week_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a short string that was stored alongside a week number in a file name,</span>
<span class="sd">    determine the corresponding pretty representation.</span>
<span class="sd">    :param week_str: The short string that was stored in the file name. One of &#39;wc&#39;, &#39;div&#39;, &#39;conf&#39;, &#39;uflchamp&#39;, or &#39;sb&#39;</span>
<span class="sd">    :return: The title cased, full version of the week&#39;s name.</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">week_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;wc&quot;</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="s2">&quot;conf&quot;</span><span class="p">,</span> <span class="s2">&quot;sb&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">week_type</span> <span class="ow">in</span> <span class="n">week_str</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">match</span> <span class="n">week_type</span><span class="p">:</span>
                <span class="k">case</span> <span class="s2">&quot;wc&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;Wild Card&quot;</span>
                <span class="k">case</span> <span class="s2">&quot;div&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;Divisional&quot;</span>
                <span class="k">case</span> <span class="s2">&quot;conf&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;Conference Championship&quot;</span>
                <span class="k">case</span> <span class="s2">&quot;uflchamp&quot;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;UFL Championship&quot;</span>
                <span class="k">case</span> <span class="s2">&quot;sb&quot;</span><span class="p">:</span>
                    <span class="n">sb_num</span> <span class="o">=</span> <span class="n">week_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;sb&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Super Bowl </span><span class="si">{</span><span class="n">sb_num</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>



<div class="viewcode-block" id="transform_file_name">
<a class="viewcode-back" href="../../api.html#fbdl.base.transform_file_name">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">transform_file_name</span><span class="p">(</span><span class="n">orig_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A specialized function that takes a file which follows the naming convention of a specific YouTube channel,</span>
<span class="sd">    and transforms the name to match our convention and play nice with Plex, Jellyfin, etc.</span>
<span class="sd">    :param orig_file: Path object representing the originally downloaded file.</span>
<span class="sd">    :type: orig_file: Path</span>
<span class="sd">    :return: The transformed file _stem_ as a string.</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stem</span> <span class="o">=</span> <span class="n">orig_file</span><span class="o">.</span><span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;UGA&quot;</span><span class="p">,</span> <span class="s2">&quot;Georgia&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;at&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bowl_str</span> <span class="o">:=</span> <span class="n">is_bowl_game</span><span class="p">(</span><span class="n">orig_file</span><span class="p">):</span>
        <span class="n">stem</span> <span class="o">=</span> <span class="n">stem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">bowl_str</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">bowl_str</span> <span class="o">=</span> <span class="n">bowl_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-Final&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">stem_parts</span> <span class="o">=</span> <span class="n">stem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

    <span class="n">year</span> <span class="o">=</span> <span class="n">stem_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">game_num</span> <span class="o">=</span> <span class="n">stem_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">stem_parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">divider_index</span> <span class="o">=</span> <span class="n">stem_parts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;at&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">divider_index</span> <span class="o">=</span> <span class="n">stem_parts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;vs&quot;</span><span class="p">)</span>

    <span class="n">divider</span> <span class="o">=</span> <span class="n">stem_parts</span><span class="p">[</span><span class="n">divider_index</span><span class="p">]</span>

    <span class="n">team_one</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stem_parts</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="n">divider_index</span><span class="p">])</span>
    <span class="n">team_two</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stem_parts</span><span class="p">[</span><span class="n">divider_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:])</span>

    <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;NCAA - s</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">e</span><span class="si">{</span><span class="n">game_num</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">game_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">game_num</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}{</span><span class="n">bowl_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">new_stem</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2"> - &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">_Gm</span><span class="si">{</span><span class="n">game_str</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">team_one</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">divider</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">team_two</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">new_stem</span></div>



<div class="viewcode-block" id="BaseDownloader">
<a class="viewcode-back" href="../../api.html#fbdl.base.BaseDownloader">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BaseDownloader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A wrapper around YoutubeDL that allows for download a list of generic URLs stored in a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">cookie_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">destination_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">add_yt_opts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct the BaseDownloader and store specification information to be passed to ydl.</span>

<span class="sd">        :param cookie_file_path: A Netscape formatted .txt file containing cookies to be used for authentication.</span>
<span class="sd">        :type cookie_file_path: str | Path | None</span>

<span class="sd">        :param destination_dir: The directory downloaded files should be stored in. Can be a string or a Path object.</span>
<span class="sd">        :type destination_dir: str | Path | None</span>

<span class="sd">        :param add_yt_opts: A dict of options to pass along to YoutubeDL in addition to the base parameters used by</span>
<span class="sd">            fbdl. The values passed in this parameter will supersede any base parameters, and can be overriden when</span>
<span class="sd">            download_from_file is invoked.</span>
<span class="sd">        :type add_yt_opts: Dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cookie_file_path</span> <span class="o">=</span> <span class="n">cookie_file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_yt_opts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;bestvideo[ext=mp4]+bestaudio[ext=m4a]/best[ext=mp4]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;merge_output_format&quot;</span><span class="p">:</span> <span class="s2">&quot;mp4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;concurrent_fragment_downloads&quot;</span><span class="p">:</span> <span class="n">CONCURRENT_FRAGMENTS</span><span class="p">,</span>
            <span class="s2">&quot;addmetadata&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;throttledratelimit&quot;</span><span class="p">:</span> <span class="n">THROTTLED_RATE_LIMIT</span><span class="p">,</span>
            <span class="s2">&quot;embedsubs&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;writesubs&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;subtitleslangs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;en&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cookie_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_yt_opts</span><span class="p">[</span><span class="s2">&quot;cookiesfrombrowser&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;firefox&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cookie_file_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add_yt_opts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_yt_opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_yt_opts</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">destination_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">destination_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">destination_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">destination_dir</span> <span class="o">=</span> <span class="n">destination_dir</span>

<div class="viewcode-block" id="BaseDownloader.download_from_file">
<a class="viewcode-back" href="../../api.html#fbdl.base.BaseDownloader.download_from_file">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">download_from_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">input_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">dlp_overrides</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use YoutubeDL to download the videos stored at each URL from input_file.</span>

<span class="sd">        :param input_file: The file where URLs are listed, one per line, to be downloaded.</span>
<span class="sd">        :type input_file: Path</span>

<span class="sd">        :param dlp_overrides: A dict storing YoutubeDL parameters to be used for this invocation of download_from_file</span>
<span class="sd">        :type dlp_overrides: Dict | None</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading files from </span><span class="si">{</span><span class="n">input_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">urls</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

        <span class="n">output_template</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination_dir</span> <span class="o">/</span> <span class="s2">&quot;</span><span class="si">%(title)s</span><span class="s2">.</span><span class="si">%(ext)s</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">overridden_opts</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">base_yt_opts</span><span class="p">,</span>
            <span class="s2">&quot;outtmpl&quot;</span><span class="p">:</span> <span class="n">output_template</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">dlp_overrides</span><span class="p">:</span>
            <span class="n">overridden_opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dlp_overrides</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">YoutubeDL</span><span class="p">(</span><span class="n">overridden_opts</span><span class="p">)</span> <span class="k">as</span> <span class="n">ydl</span><span class="p">:</span>
            <span class="n">ydl</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="FileOperationsUtil">
<a class="viewcode-back" href="../../api.html#fbdl.base.FileOperationsUtil">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FileOperationsUtil</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A utility class for file operations such as renaming, converting, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">directory_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">pretend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a util object, storing the directory we will be working in.</span>
<span class="sd">            TODO: Is this really the right place for directory_path?</span>

<span class="sd">        :param directory_path: The directory containing the files on which we will be operating.</span>
<span class="sd">        :type directory_path: str | Path</span>
<span class="sd">        :param pretend: If True, only simulate operations.</span>
<span class="sd">        :type pretend: bool</span>
<span class="sd">        :param verbose: If True, enable verbose logging.</span>
<span class="sd">        :type verbose: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">directory_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">directory_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">directory_path</span> <span class="o">=</span> <span class="n">directory_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pretend</span> <span class="o">=</span> <span class="n">pretend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_log_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">var</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log (or print) the variable&#39;s name, and its string representation</span>
<span class="sd">        # TODO: Change this from print calls to logger invocations</span>

<span class="sd">        :param name: (Typically) the name of the object being logged.</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param var: The object to log.</span>
<span class="sd">        :type var: Any</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value: </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="FileOperationsUtil.update_mp4_title_from_filename">
<a class="viewcode-back" href="../../api.html#fbdl.base.FileOperationsUtil.update_mp4_title_from_filename">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_mp4_title_from_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Using information stored in a mp4 file&#39;s name, update the title stored in its metadata</span>

<span class="sd">        :param file_obj: The file to update.</span>
<span class="sd">        :type file_obj: Path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretend</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pretend flag was passed. Will not save updates.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating metadata for games in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">directory_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Working on </span><span class="si">{</span><span class="n">file_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">audio</span> <span class="o">=</span> <span class="n">MP4</span><span class="p">(</span><span class="n">file_obj</span><span class="p">)</span>

            <span class="c1"># Get the filename without extension</span>
            <span class="n">base_name</span> <span class="o">=</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_var</span><span class="p">(</span><span class="s2">&quot;Base Name&quot;</span><span class="p">,</span> <span class="n">base_name</span><span class="p">)</span>

            <span class="n">name_parts</span> <span class="o">=</span> <span class="n">base_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_var</span><span class="p">(</span><span class="s2">&quot;Name Parts&quot;</span><span class="p">,</span> <span class="n">name_parts</span><span class="p">)</span>

            <span class="n">year</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_var</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>

            <span class="n">away_city</span> <span class="o">=</span> <span class="n">abbreviation_map</span><span class="p">[</span><span class="n">name_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="n">home_city</span> <span class="o">=</span> <span class="n">abbreviation_map</span><span class="p">[</span><span class="n">name_parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
            <span class="n">at_vs</span> <span class="o">=</span> <span class="s2">&quot;vs&quot;</span> <span class="k">if</span> <span class="s2">&quot;SB&quot;</span> <span class="ow">in</span> <span class="n">name_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;at&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log_var</span><span class="p">(</span><span class="s2">&quot;@ or vs&quot;</span><span class="p">,</span> <span class="n">at_vs</span><span class="p">)</span>

            <span class="n">new_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">away_city</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">at_vs</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">home_city</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_var</span><span class="p">(</span><span class="s2">&quot;New name&quot;</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>

            <span class="n">audio</span><span class="p">[</span><span class="s2">&quot;</span><span class="se">\xa9</span><span class="s2">nam&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_name</span>  <span class="c1"># Tags are often lists in MP4</span>
            <span class="n">audio</span><span class="p">[</span><span class="s2">&quot;</span><span class="se">\xa9</span><span class="s2">day&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretend</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving file.&quot;</span><span class="p">)</span>
                <span class="n">audio</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated title for &#39;</span><span class="si">{</span><span class="n">file_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; to: &#39;</span><span class="si">{</span><span class="n">new_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing &#39;</span><span class="si">{</span><span class="n">file_obj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span></div>


<div class="viewcode-block" id="FileOperationsUtil.iter_and_update_children">
<a class="viewcode-back" href="../../api.html#fbdl.base.FileOperationsUtil.iter_and_update_children">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">iter_and_update_children</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update all mp4 files in the current directory and all its children.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.mp4&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_mp4_title_from_filename</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileOperationsUtil.convert_formats">
<a class="viewcode-back" href="../../api.html#fbdl.base.FileOperationsUtil.convert_formats">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_formats</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">orig_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mkv&quot;</span><span class="p">,</span> <span class="n">new_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mp4&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use ffmpeg to convert video files in self.directory_path from one format to another.</span>

<span class="sd">        :param orig_format: Convert all videos of this format</span>
<span class="sd">        :type orig_format: str</span>

<span class="sd">        :param new_format: The new format to store the videos in.</span>
<span class="sd">        :type new_format: str</span>

<span class="sd">        :param delete: If True, delete the original files of the old format.</span>

<span class="sd">        :return: List of file names (stem only) that were successfully converted.</span>
<span class="sd">        :rtype: List[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">successfully_converted</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mkv_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*.</span><span class="si">{</span><span class="n">orig_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="n">orig_stem</span> <span class="o">=</span> <span class="n">mkv_file</span><span class="o">.</span><span class="n">stem</span>

            <span class="n">stream</span> <span class="o">=</span> <span class="n">ffmpeg</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mkv_file</span><span class="p">))</span>
            <span class="n">output_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mkv_file</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">new_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">ffmpeg</span><span class="o">.</span><span class="n">output</span><span class="p">(</span>
                <span class="n">stream</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">vcodec</span><span class="o">=</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="n">acodec</span><span class="o">=</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mp4&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretend</span><span class="p">:</span>
                <span class="n">log_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Would convert </span><span class="si">{</span><span class="n">mkv_file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
                    <span class="n">log_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Would delete </span><span class="si">{</span><span class="n">mkv_file</span><span class="si">}</span><span class="s2"> as well.&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">log_str</span><span class="p">)</span>
                <span class="n">successfully_converted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orig_stem</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting </span><span class="si">{</span><span class="n">mkv_file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">ffmpeg</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
                <span class="n">successfully_converted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orig_stem</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting </span><span class="si">{</span><span class="n">mkv_file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                    <span class="n">mkv_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">successfully_converted</span></div>


<div class="viewcode-block" id="FileOperationsUtil.rename_files">
<a class="viewcode-back" href="../../api.html#fbdl.base.FileOperationsUtil.rename_files">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rename_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">series_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A specialized method to rename TV series episode files from the format</span>
<span class="sd">            XYY-&lt;episode_name&gt;.mp4 to &lt;series_name&gt; - sXXeYY - &lt;episode_name&gt;.mp4</span>
<span class="sd">            Where X is the episode season, and YY is the episode number within that season.</span>

<span class="sd">        :param series_name: Name of the TV series we should rename files for.</span>
<span class="sd">        :type series_name: str</span>
<span class="sd">        :param replace: If True, overwrite any files which happen to exist with the</span>
<span class="sd">            target name already.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Regular expression to match the xyy-&lt;Episode Name&gt;.mp4 format</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;^(\d</span><span class="si">{1}</span><span class="s2">)(\d{2,3})-(.+)\.mp4$&quot;</span>

        <span class="c1"># Iterate through all subdirectories</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.mp4&quot;</span><span class="p">):</span>
            <span class="c1"># Check if file matches the expected pattern</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">season</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Extract season number (x)</span>
                <span class="n">episode</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Extract episode number (yy)</span>
                <span class="n">episode_name</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Extract episode name</span>

                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">series_name</span><span class="si">}</span><span class="s2"> - s</span><span class="si">{</span><span class="n">season</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">e</span><span class="si">{</span><span class="n">episode</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">.mp4&quot;</span>
                <span class="n">new_file_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="n">new_filename</span><span class="p">)</span>
                <span class="n">delete_</span> <span class="o">=</span> <span class="n">new_file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretend</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">delete_</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s2"> already exists, would be replaced.&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Would rename </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s2">.&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot; --pretend was passed, so we will not attempt the operation.&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">delete_</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">replace</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s2"> already exists and replace is False&quot;</span>
                        <span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Renaming </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">new_file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">new_file_path</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success.&quot;</span><span class="p">)</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">fbdl</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, fbdl.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>